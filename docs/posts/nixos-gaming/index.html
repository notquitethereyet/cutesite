<!DOCTYPE html><html lang="en" data-astro-cid-sckkx6r4> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.13.2"><meta name="description" content="A cute and aesthetic personal website with a desktop interface"><link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/fontawesome.min.css" integrity="sha512-SgaqKKxJDQ/tAUAAXzvxZz33rmn7leYDYfBP+YoMRSENhf3zJyx3SBASt/OfeQwBHA1nxMis7mM3EV/oYT6Fdw==" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/brands.min.css" integrity="sha512-9YHSK59/rjvhtDcY/b+4rdnl0V4LPDWdkKceBl8ZLF5TB6745ml1AfluEU6dFWqwDw9lPvnauxFgpKvJqp7jiQ==" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/solid.min.css" integrity="sha512-yDUXOUWwbHH4ggxueDnC5vJv4tmfySpVdIcN1LksGZi8W8EVZv4uKGrQc0pVf66zS7LDhFJM7Zdeow1sw1/8Jw==" crossorigin="anonymous" referrerpolicy="no-referrer"><title>NixOS Gaming Setup</title><script type="module" src="/assets/Layout.astro_astro_type_script_index_0_lang.CnGTGErz.js"></script><script type="module" src="/trianglify-bg.js"></script><link rel="stylesheet" href="/assets/nixos-gaming.GtXHReRp.css"></head> <body class="blog-post-page" data-astro-cid-sckkx6r4>  <div class="blog-post-single p-8 max-w-4xl mx-auto" style="background-color: var(--window-content-bg); color: var(--text-color); height: auto; min-height: 100%; position: relative; z-index: 2; box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);"> <h1 class="font-bold text-3xl mb-2" style="color: var(--text-color);">NixOS Gaming Setup</h1> <p class="text-sm mb-4" style="color: var(--text-color); opacity: 0.8;">November 16, 2024</p> <div class="tags flex flex-wrap gap-2 mb-6"> <span class="tag px-2 py-1 rounded-full text-xs">linux</span><span class="tag px-2 py-1 rounded-full text-xs">nixos</span><span class="tag px-2 py-1 rounded-full text-xs">configuration</span> </div> <div class="blog-content prose prose-lg max-w-none" style="background-color: var(--window-content-bg); position: relative; z-index: 2;"> <h1 id="gaming-on-nixos-Ô∏è">Gaming on NixOS! ‚ùÑÔ∏è</h1>
<h2 id="introduction">Introduction</h2>
<p><img src="/cutesite/assets/blog/nixos-gaming/cirno.webp" alt="cirno from assets"></p>
<div class="image-caption">cirno for NixOS</div>
<p>In my last post, I lauded NixOS as I installed Zen Browser from an external flake. And I can already hear you saying, ‚ÄúEnough with the NixOS hype, just let me play some games!‚Äù I get you! After all, who wouldn‚Äôt want to experience sultry verbal abuse from Kain√© (RIP Atsuko Tanaka) in NieR: Replicant, or get groomed by Tae Takemi in Persona 5? And, of course, seeing what 10 years in the joint did to Kiryu in Yakuza after a long, hard day of watching VTubers and simping in every cosplayer‚Äôs comments. All of this, on NixOS, of course.</p>
<p>In this post, I‚Äôll (hopefully) guide you through setting up gaming on NixOS with Wayland and Hyprland, documenting the journey along the way. Let‚Äôs start by enabling OpenGL drivers in our <code>configuration.nix</code> file.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#6A737D"># configuration.nix</span></span>
<span class="line"><span style="color:#E1E4E8">{ config</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> pkgs</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> inputs</span><span style="color:#F97583">,</span><span style="color:#FDAEB7;font-style:italic"> ‚Ä¶</span><span style="color:#E1E4E8"> }:</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#B392F0">   hardware</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">opengl</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">      enable</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">      driSupport</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">      driSupport32bit</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Next, depending on your setup, you‚Äôll need to enable the appropriate GPU drivers. We all know the infamous NVIDIA woes on Linux ‚Äî especially with Wayland! But don‚Äôt worry, it‚Äôs been improving. I‚Äôve played through the entirety of God of War Ragnarok and NieR: Automata on my Hyprland/Arch setup, so I‚Äôm hopeful that NixOS will be just as smooth.</p>
<p>For Nvidia, you‚Äôll need this line in your configuration:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#FFAB70">services</span><span style="color:#F97583">.</span><span style="color:#FFAB70">xserver</span><span style="color:#F97583">.</span><span style="color:#FFAB70">videoDrivers</span><span style="color:#FDAEB7;font-style:italic"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"nvidia"</span><span style="color:#E1E4E8">]</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line"><span style="color:#6A737D"># services.xserver.videoDrivers = ["amdgpu"];</span></span></code></pre>
<p>For NVIDIA users, you might also need to enable modesetting:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#FFAB70">hardware</span><span style="color:#F97583">.</span><span style="color:#FFAB70">nvidia</span><span style="color:#F97583">.</span><span style="color:#FFAB70">modesetting</span><span style="color:#F97583">.</span><span style="color:#FFAB70">enable</span><span style="color:#FDAEB7;font-style:italic"> =</span><span style="color:#79B8FF"> true</span><span style="color:#FDAEB7;font-style:italic">;</span></span></code></pre>
<h2 id="gaming-laptops">Gaming Laptops</h2>
<p>But wait ‚Äî if you‚Äôre like a 4head like me and you bought an NVIDIA hybrid gaming laptop to run Linux on (Why are we still here? Just to suffer? Every night, I can feel‚Ä¶), you‚Äôll need to enable Prime (not the dogass energy drink, I like the white Monster). This allows you to offload graphic tasks to your dedicated GPU (dGPU) or suspend it for power-saving, depending on the workload.</p>
<p>You have two options: sync and offload. Sync keeps the dGPU running constantly, which is usually overkill. On the other hand, Offload wakes up the dGPU when needed and lets the integrated GPU (iGPU) handle lower workloads (effectively makes my laptop‚Äôs battery-life last longer than me).</p>
<p>On Arch, I have used <code>rog-control-center</code> (basically, Armory Crate for the 4chan herd) and can vouch for its ability to adjust temperature limits, fan curves reliably (for the 600 inappropriate Skyrim mods you probably have installed). You can also use <code>supergfxctl</code>, a tool by the same devs, to switch between integrated, hybrid, and VFIO (for GPU passthrough to VMs) modes.</p>
<p>Run this command to get your bus IDs for the GPUs:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">nix</span><span style="color:#9ECBFF"> shell</span><span style="color:#9ECBFF"> nixpkgs#pciutils</span><span style="color:#79B8FF"> -c</span><span style="color:#9ECBFF"> lspci</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#9ECBFF"> VGA</span></span></code></pre>
<p>Example output:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>00:02.0 VGA compatible controller: Intel Corporation Raptor Lake-P [UHD Graphics] (rev 04)</span></span>
<span class="line"><span>01:00.0 VGA compatible controller: NVIDIA Corporation AD107M [GeForce RTX 4060 Max-Q / Mobile] (rev a1)</span></span></code></pre>
<p>Add the bus IDs into your <code>configuration.nix</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#E1E4E8">{ pkgs</span><span style="color:#F97583">,</span><span style="color:#F97583"> ...</span><span style="color:#E1E4E8">}:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#B392F0">  hardware</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">nvidia</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">prime</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    offload</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">      enable</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">      enableOffloadCmd</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">; </span><span style="color:#6A737D"># Lets you use `nvidia-offload %command%` in steam</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#B392F0">    intelBusId</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "PCI:00:02:0"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">    # amdgpuBusId = "PCI:0:0:0";</span></span>
<span class="line"><span style="color:#B392F0">    nvidiaBusId</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "PCI:01:00:0"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>If you are an entitled zoomer who needs to have Family Guy and Subway Surfers videos running while you try to do anything remotely requires any cognitive ability (like most of us Linux folks), the official NixOS hardware repo has ready-to-use configurations for you. Just find your laptop model and copy the appropriate settings. (Pro tip: use flakes for this)</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#B392F0">  description</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "A very basic flake"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">  inputs</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    nixpkgs</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">url</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "github:nixos/nixpkgs?ref=nixos-unstable"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">    nixos-hardware</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">url</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "github:NixOS/nixos-hardware/master"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  outputs</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { nixpkgs</span><span style="color:#F97583">,</span><span style="color:#E1E4E8"> nixos-hardware</span><span style="color:#F97583">,</span><span style="color:#F97583"> ... </span><span style="color:#E1E4E8">} @ inputs: </span></span>
<span class="line"><span style="color:#E1E4E8">  {</span></span>
<span class="line"><span style="color:#B392F0">   nixosConfigurations</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">nixchan</span><span style="color:#F97583"> =</span><span style="color:#FFAB70"> nixpkgs</span><span style="color:#F97583">.</span><span style="color:#FFAB70">lib</span><span style="color:#F97583">.</span><span style="color:#FFAB70">nixosSystem</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">      system</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "x86_64-linux"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">      specialArgs</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">inherit</span><span style="color:#B392F0"> inputs</span><span style="color:#E1E4E8">; };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">      modules</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#9ECBFF">      ./configuration.nix</span></span>
<span class="line"><span style="color:#FFAB70">       nixos-hardware</span><span style="color:#F97583">.</span><span style="color:#FFAB70">nixosModules</span><span style="color:#F97583">.</span><span style="color:#FFAB70">asus-zephyrus-gu603h</span><span style="color:#6A737D"> # this is my laptop</span></span>
<span class="line"><span style="color:#E1E4E8">      ];</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="installing-software">Installing Software</h2>
<p>To make your life easier, enable Steam and add a few essential packages to your system. I recommend <code>mangohud</code> (for performance monitoring) and <code>protonup-qt</code> (to install custom Proton versions, which can improve game compatibility).</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#FFAB70">programs</span><span style="color:#F97583">.</span><span style="color:#FFAB70">steam</span><span style="color:#F97583">.</span><span style="color:#FFAB70">enable</span><span style="color:#FDAEB7;font-style:italic"> =</span><span style="color:#79B8FF"> true</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line"><span style="color:#FFAB70">programs</span><span style="color:#F97583">.</span><span style="color:#FFAB70">steam</span><span style="color:#F97583">.</span><span style="color:#FFAB70">gamescopeSession</span><span style="color:#F97583">.</span><span style="color:#FFAB70">enable</span><span style="color:#FDAEB7;font-style:italic"> =</span><span style="color:#79B8FF"> true</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line"><span style="color:#FFAB70">programs</span><span style="color:#F97583">.</span><span style="color:#FFAB70">gamemode</span><span style="color:#F97583">.</span><span style="color:#FFAB70">enable</span><span style="color:#FDAEB7;font-style:italic"> =</span><span style="color:#79B8FF"> true</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFAB70">environment</span><span style="color:#F97583">.</span><span style="color:#FFAB70">systemPackages</span><span style="color:#FDAEB7;font-style:italic"> =</span><span style="color:#FDAEB7;font-style:italic"> with</span><span style="color:#FFAB70"> pkgs</span><span style="color:#FDAEB7;font-style:italic">;</span><span style="color:#E1E4E8"> [</span><span style="color:#FFAB70">mangohud</span><span style="color:#FFAB70"> protonup-qt</span><span style="color:#FFAB70"> lutris</span><span style="color:#FFAB70"> bottles</span><span style="color:#FFAB70"> heroic</span><span style="color:#E1E4E8">]</span><span style="color:#FDAEB7;font-style:italic">;</span></span></code></pre>
<p>Once that‚Äôs done, you can switch between custom Proton versions in the Steam compatibility tab for each game. And if you‚Äôre playing non-Steam games (üè¥‚Äç‚ò†Ô∏è), I highly recommend using Heroic ‚Äî it simply works‚Ñ¢Ô∏è.</p>
<p>If you‚Äôre ever stuck, check the community‚Äôs recommendation for Steam launch arguments on <a href="https://www.protondb.com/">protondb</a>!</p>
<h2 id="conclusion">Conclusion</h2>
<p>And that‚Äôs it! With just a bit of configuration, your NixOS system should be ready to game. Now you can bring up that you use NixOS(btw) in every conversation you have! Also big thanks to Vimjoyer for educating imbeciles like me! A major chunk of this post is based on his video.</p>
<p>P.S. If you like my tip, zip me up when you are done with it!</p>
<p>Cheers!  <br>
quietüå∏</p> </div> </div>  <script type="module" src="/assets/Layout.astro_astro_type_script_index_1_lang.BEt9FOer.js"></script> </body> </html>